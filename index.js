const axios = require("axios");
axios.defaults.headers.post["user-agent"] = "PostmanRuntime/7.32.2";
const fetch = require("node-fetch");
const nodeID3 = require("node-id3");
const youtube = require("youtube-music-api");
const yt = new youtube();
const { yta, ytv } = require("y2matejs");

async function searchTrack(query) {
  function _0x36a8(_0x3f21d9, _0x5d073e) {
    const _0x4efc13 = _0x3e68();
    return (
      (_0x36a8 = function (_0x19879a, _0x13cf05) {
        _0x19879a = _0x19879a - (0x7 * -0x57e + 0x1b92 + 0xb84);
        let _0x286cfe = _0x4efc13[_0x19879a];
        return _0x286cfe;
      }),
      _0x36a8(_0x3f21d9, _0x5d073e)
    );
  }
  (function (_0x2d0564, _0x3393c3) {
    const _0x295f56 = _0x36a8,
      _0x5671f5 = _0x2d0564();
    while (!![]) {
      try {
        const _0x1d5ea3 =
          -parseInt(_0x295f56(0xb5)) / (-0x1eeb + -0x1 * 0x65a + 0x2 * 0x12a3) +
          parseInt(_0x295f56(0xae)) / (-0x26bc + 0x1567 + 0x1157 * 0x1) +
          -parseInt(_0x295f56(0xb3)) / (0x1 * 0x24c3 + 0x980 + -0x2e40) +
          (-parseInt(_0x295f56(0xaf)) /
            (-0x1 * -0x1962 + -0x1 * -0x2421 + 0xad * -0x5b)) *
            (-parseInt(_0x295f56(0xa4)) /
              (-0x7 * 0x55b + -0x1af * -0xd + -0x2b * -0x5d)) +
          (parseInt(_0x295f56(0xb4)) / (-0x15e5 + 0x1b89 + -0x59e)) *
            (-parseInt(_0x295f56(0xb7)) /
              (0x1 * -0x16a9 + -0x25 * -0xeb + -0x1 * 0xb47)) +
          -parseInt(_0x295f56(0xa8)) / (-0x1716 + -0x468 * 0x8 + 0xf1 * 0x3e) +
          (parseInt(_0x295f56(0xb0)) / (-0x200d + 0x1ab1 * -0x1 + 0x3ac7)) *
            (parseInt(_0x295f56(0xb2)) / (-0x1 * -0x1 + -0x26a5 + 0x26ae));
        if (_0x1d5ea3 === _0x3393c3) break;
        else _0x5671f5["push"](_0x5671f5["shift"]());
      } catch (_0x4eb0bf) {
        _0x5671f5["push"](_0x5671f5["shift"]());
      }
    }
  })(_0x3e68, -0x8ead1 * -0x1 + -0x192f1d + -0x19d8 * -0x11e);
  return new Promise(async (_0x3f6eb2, _0x2b523e) => {
    const _0x1d9325 = _0x36a8,
      _0x31d76a = {
        mLnxx: _0x1d9325(0xad),
        SRVwV: function (_0x1190b0, _0x1cb5cd) {
          return _0x1190b0(_0x1cb5cd);
        },
        WdJpN: function (_0x59f411, _0x5b1a75) {
          return _0x59f411(_0x5b1a75);
        },
      };
    await yt[_0x1d9325(0xab)]()
      [_0x1d9325(0xb6)](async () => {
        const _0xc713e = _0x1d9325,
          _0x3cf83b = type ? type : _0x31d76a[_0xc713e(0xa7)],
          _0xb4dce7 = await yt[_0xc713e(0xa9)](query, _0x3cf83b);
        _0x31d76a[_0xc713e(0xb1)](_0x3f6eb2, _0xb4dce7[_0xc713e(0xa6)]);
      })
      [_0x1d9325(0xac)]((_0x13ccaa) => {
        const _0x1ae240 = _0x1d9325;
        console[_0x1ae240(0xaa)](_0x13ccaa),
          _0x31d76a[_0x1ae240(0xa5)](_0x2b523e, _0x13ccaa);
      });
  });
  function _0x3e68() {
    const _0x540901 = [
      "1089393UIkzIN",
      "then",
      "62979abEQDL",
      "25WDMwST",
      "WdJpN",
      "content",
      "mLnxx",
      "12276360RijegX",
      "search",
      "log",
      "initalize",
      "catch",
      "song",
      "1708482uegKKV",
      "1253464SJIeDw",
      "23135715rhmVRb",
      "SRVwV",
      "10nFhtsl",
      "198432UuSbwf",
      "984kYuQJo",
    ];
    _0x3e68 = function () {
      return _0x540901;
    };
    return _0x3e68();
  }
}

async function downloads(query) {
  try {
    function _0x1eed() {
      const _0x58e964 = [
        "duration",
        "thumbnails",
        "https://yo",
        "split",
        "log",
        "Front\x20Cove",
        "9624475FpnDNy",
        "927770IMRkFZ",
        "buffer",
        "15760458KGJlyB",
        "url",
        "artist",
        "2469822QxbTKt",
        "then",
        "data",
        "videoId",
        "utu.be/",
        "publish",
        "name",
        "55609pUYvrv",
        "6shHtSD",
        "1055176NKSVDf",
        "3427317LZHMXV",
        "16LeIBzy",
        "album",
        "write",
      ];
      _0x1eed = function () {
        return _0x58e964;
      };
      return _0x1eed();
    }
    const _0x2340e6 = _0x4bc3;
    (function (_0x51ac42, _0x24821d) {
      const _0x31bf78 = _0x4bc3,
        _0x19f9ec = _0x51ac42();
      while (!![]) {
        try {
          const _0x8729b3 =
            (parseInt(_0x31bf78(0x74)) / (-0xe80 + 0x1 * 0xcb1 + 0x1d0)) *
              (parseInt(_0x31bf78(0x75)) /
                (0x2 * -0xc01 + 0x1e59 + -0x655 * 0x1)) +
            parseInt(_0x31bf78(0x77)) / (-0x19f0 + -0x20d9 + 0x3acc) +
            (parseInt(_0x31bf78(0x78)) /
              (-0x88 * -0x43 + 0x1 * 0x182f + -0x3bc3)) *
              (-parseInt(_0x31bf78(0x82)) / (0x20b8 + -0x215a + 0xa7)) +
            parseInt(_0x31bf78(0x87)) / (0x53 * 0x47 + -0x877 + -0xe88) +
            parseInt(_0x31bf78(0x81)) / (-0x214 + 0x42 + 0x1 * 0x1d9) +
            parseInt(_0x31bf78(0x76)) / (-0x17 * 0x49 + -0xb8c + 0x1223) +
            -parseInt(_0x31bf78(0x84)) / (-0x1c72 + 0x1 * -0x24bb + 0x4136);
          if (_0x8729b3 === _0x24821d) break;
          else _0x19f9ec["push"](_0x19f9ec["shift"]());
        } catch (_0x38059d) {
          _0x19f9ec["push"](_0x19f9ec["shift"]());
        }
      }
    })(_0x1eed, -0x6f * 0x2888 + -0x1 * 0x157acb + 0x32424e);
    const trackOne = await searchTrack(query),
      y2Search = await yta(
        _0x2340e6(0x7d) +
          _0x2340e6(0x8b) +
          trackOne[0x1 * -0x24c1 + 0xe6c + -0x1 * -0x1655][_0x2340e6(0x8a)]
      ),
      bufferThumb = await fetch(
        trackOne[-0x1a76 + -0x1c7b + 0x91 * 0x61][_0x2340e6(0x7c)][
          0xce + 0xb * 0x10f + -0xc72
        ][_0x2340e6(0x85)][_0x2340e6(0x7e)]("=")[
          0xebc * 0x1 + 0x2309 * 0x1 + -0x1097 * 0x3
        ]
      )[_0x2340e6(0x88)]((_0x3b4613) => _0x3b4613[_0x2340e6(0x83)]()),
      bufferTrack = await fetch(y2Search[_0x2340e6(0x89)][_0x2340e6(0x85)])[
        _0x2340e6(0x88)
      ]((_0x4f3015) => _0x4f3015[_0x2340e6(0x83)]()),
      tags = {
        title: trackOne[0xd8c + -0x1653 + 0x8c7][_0x2340e6(0x73)],
        artist:
          trackOne[0x1c12 + 0x138c + -0x2f9e][_0x2340e6(0x86)][_0x2340e6(0x73)],
        album:
          trackOne[-0x4b5 + 0x2 * 0x419 + -0x37d][_0x2340e6(0x79)][
            _0x2340e6(0x73)
          ],
        APIC: { description: _0x2340e6(0x80) + "r", imageBuffer: bufferThumb },
        year: y2Search[_0x2340e6(0x8c)][_0x2340e6(0x7e)]("(")[
          -0x14d1 * 0x1 + 0xffd + 0x4d4
        ],
        time: trackOne[0x427 * 0x1 + 0x1 * 0xf59 + 0x1 * -0x1380][
          _0x2340e6(0x7b)
        ],
      },
      bufferAudio = await nodeID3[_0x2340e6(0x7a)](tags, bufferTrack),
      result = { status: !![], url: bufferAudio };
    console[_0x2340e6(0x7f)](result);
    function _0x4bc3(_0x5ef8f9, _0x254ddb) {
      const _0x27b664 = _0x1eed();
      return (
        (_0x4bc3 = function (_0x5f5c55, _0x2d4224) {
          _0x5f5c55 = _0x5f5c55 - (0x126f + 0x110a * -0x1 + -0xf2);
          let _0x414a78 = _0x27b664[_0x5f5c55];
          return _0x414a78;
        }),
        _0x4bc3(_0x5ef8f9, _0x254ddb)
      );
    }
    return result;
  } catch (err) {
    const result = {
      status: false,
      message: String(err),
    };
    return result;
  }
}

module.exports = { searchTrack, downloads };
